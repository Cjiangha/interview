"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(){var t=getCookie("username");function e(t){_classCallCheck(this,e),this.carBox=$(t),this.init()}new(_createClass(e,[{key:"init",value:function(){this.creatList(),this.addNum(),this.cutNum(),this.manual(),this.removeRow(),this.allCheck(),this.checkRow(),this.allRemove()}},{key:"creatList",value:function(){"xuanrang",getCookie("username")&&$.ajax({type:"post",url:"../api/cartxuanrang.php",data:{username:t,type:"xuanrang"},success:function(t){var e=JSON.parse(t).map(function(t,e){var a=t.gprice,n=t.gnum;return'<li class="item-list" data-sid="'+t.sid+'">\n                                        <div class="cell p-checkbox">\n                                            <input type="checkbox" class="jdcheckbox">\n                                        </div>\n                                        <div class="cell p-goods">\n                                            <div class="p-img">\n                                                <img src=" '+t.gtu+'" alt="">\n                                            </div>\n                                            <div class="p-name title">\n                                                <a href="###">\n                                                    <em class="jdint-icon"></em>\n                                                    '+t.gtitle+'\n                                                </a>\n                                            </div>\n                                            <span class="clear">\n                \n                                            </span>\n                                        </div>\n                                        <div class="cell p-props">\n                                            <div class="props-txt"></div>\n                                            <div class="props-txt"></div>\n                                        </div>\n                                        <div class="cell p-price">\n                                            <strong>'+a+'</strong>\n                                        </div>\n                                        <div class="cell p-quantity">\n                                            <a href="###" class="decrement disabled">-</a>\n                                            <input type="text" class="itxt" data-kucun="10" value="'+t.gnum+'">\n                                            <a href="###" class="increment">+</a>\n                                        </div>\n                                        <div class="cell p-sum">\n                                            <strong>'+(a*n).toFixed(2)+'</strong>\n                                        </div>\n                                        <div class="cell p-action">\n                                            <a href="###" class="cart-remove">删除</a>\n                                        </div>\n                                        <span class="clear"></span>\n                                    </li>'}).join("");$(".liebiao").html(e)}})}},{key:"total",value:function(t,e,a){var n=$(t).parent().find(".itxt").data("kucun");e<1?e=1:n<e&&(e=n),$(t).parent().find(".itxt").val(e);var c=(e*$(t).parent().prev().text().slice(2)).toFixed(2);$(t).parent().next().find("strong").html(c);var i=$(t).parent().parent().data("sid");$.ajax({type:"post",url:"../api/cartxuanrang.php",data:{sid:i,gnum:e,type:"update"},success:function(t){}}),this.allNum()}},{key:"addNum",value:function(){var e=this;this.carBox.on("click",".increment",function(){var t=$(this).prev().val();t++,e.total($(this),t,"add")})}},{key:"cutNum",value:function(){var e=this;this.carBox.on("click",".decrement",function(){var t=$(this).next().val();t--,e.total($(this),t,"cut")})}},{key:"manual",value:function(){var e=this;this.carBox.on("input",".itxt",function(){var t=$(this).val();e.total($(this),t,"change")})}},{key:"removeRow",value:function(){var e=this;this.carBox.on("click",".cart-remove",function(){if(confirm("你真的要删我吗？")){var t=$(this).parent().parent().data("sid");console.log(t),$.ajax({type:"post",url:"../api/deletecartitem.php",data:{sid:t},success:function(t){}}),$(this).parent().parent().remove()}e.allNum()})}},{key:"allCheck",value:function(){var e=this;$(".select-all .all").click(function(){var t=$(this).prop("checked");$(".jdcheckbox").prop("checked",t),e.allNum()})}},{key:"checkArr",value:function(){var a=[];return $(".p-checkbox input").each(function(t,e){$(e).prop("checked")&&a.push(t)}),a}},{key:"allNum",value:function(){var a=this.checkArr(),n=0,c=0;a.forEach(function(t,e){n+=1*$("#cart .itxt").eq(a[e]).val(),c+=1*$("#cart .p-sum").eq(a[e]).text().slice(2),$("#cart")}),$(".amount-sum em").html(""+n),$(".sumPrice em").eq(1).html(""+c.toFixed(2))}},{key:"checkRow",value:function(){var t=this;this.carBox.on("click",".p-checkbox input",function(){$(".p-checkbox input").size()==$(".p-checkbox input:checked").size()?$(".select-all .all").prop("checked",!0):$(".select-all .all").prop("checked",!1),t.allNum()})}},{key:"allRemove",value:function(){var c=this;$(".remove-batch").click(function(){var n=c.checkArr().reverse();confirm("你确定要删除我们吗？")&&n.forEach(function(t,e){var a=$(".item-list").eq(n[e]).data("sid");$.ajax({type:"post",url:"../api/deletecartitem.php",data:{sid:a},success:function(t){}}),$(".item-list").eq(n[e]).remove(),c.allNum()})})}}]),e)("#cart")}();