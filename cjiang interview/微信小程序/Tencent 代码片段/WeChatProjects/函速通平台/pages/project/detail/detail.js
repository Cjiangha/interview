(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/project/detail/detail"],{"0cb5":function(t,e,n){"use strict";n.r(e);var i=n("d290"),a=n("df16");for(var r in a)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(r);n("0f09");var o,s=n("f0c5"),c=Object(s["a"])(a["default"],i["b"],i["c"],!1,null,"98b00a5c",null,!1,i["a"],o);e["default"]=c.exports},"0f09":function(t,e,n){"use strict";var i=n("205f"),a=n.n(i);a.a},"205f":function(t,e,n){},"79c1":function(t,e,n){"use strict";(function(t){n("6cdc");i(n("66fd"));var e=i(n("0cb5"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},beee:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(n("a34a")),a=s(n("bd85")),r=n("109f"),o=n("0168");function s(t){return t&&t.__esModule?t:{default:t}}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n,i,a,r,o){try{var s=t[r](o),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(i,a)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var r=t.apply(e,n);function o(t){l(r,i,a,o,s,"next",t)}function s(t){l(r,i,a,o,s,"throw",t)}o(void 0)}))}}function p(t){return v(t)||m(t)||g(t)||h()}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(t,e){if(t){if("string"===typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function m(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function v(t){if(Array.isArray(t))return b(t)}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var I=getApp(),y={data:function(){return{submitFlag:!0,rules:r.rules,projectInfo:{},dialogAddressVisible:!1,selectAdress:[{txt:"请选择",fullname:"",id:""},{txt:"请选择",fullname:"",id:""},{txt:"请选择",fullname:"",id:""}],addressInfo:"",enterpriseQuaListData:[],guaranteeType:[],timeLenIndex:"999",timeLen:[],templateTypeIndex:"999",templateType:[],orgList:[],guaTemplate:[],chooseEnterpriseVisible:!1,templateTypeId:"",configId:"",guaDiyTemplate:[],fileStyles:{},materialUploadVisible:!1,materialsList:[],uploadUrl:"/uploadWeb",step:1,rules_two:r.rules_order,dialogSuccessVisible:!1,showCount:0}},computed:{hasLeftWin:function(){return this.$store.getters.hasLeftWin},title:function(){return 1==this.step?"自建项目":"项目信息"}},watch:{"projectInfo.enterpriseId":{handler:function(t){console.log("enterpriseId",t)}},"projectInfo.transactionPrice":{handler:function(t){t&&""!=t&&this.judgeOrg()}},selectAdress:{handler:function(t){this.$set(this.projectInfo,"projectProvince",t[0].id),this.$set(this.projectInfo,"projectCity",t[1].id),this.$set(this.projectInfo,"projectCounty",t[2].id),this.addressInfo=t[0].fullname+t[1].fullname+t[2].fullname},immediate:!0}},onLoad:function(t){var e=this,n=t.bond?t.bond:"",i=t.prjName?t.prjName:"";this.$set(this.projectInfo,"supperPrjName",i),this.$set(this.projectInfo,"bond",n),this.$native.showLoading(),Promise.all([I.selectDictByType("guarantee_nobid_product_type,guaranteeDuration"),this.selectGuaranteeTemplateType()]).then((function(t){var n=[],i=[];t[0].length>0&&t[0].forEach((function(t){"guarantee_nobid_product_type"==t.dictType?i.push(t):n.push(t)})),e.timeLen=[].concat(n),e.guaranteeType=[].concat(i),e.templateType=t[1],e.$native.hideLoading()})).catch((function(t){e.$native.hideLoading(),e.$native.toast(t)}))},onShow:function(){this.showCount++},methods:{goBack:function(){I.goBack()},openAddressDialog:function(){this.dialogAddressVisible=!0},handleCloseAddressDialog:function(){this.dialogAddressVisible=!1},handleSureAddressDialog:function(t){this.selectAdress=p(t),this.dialogAddressVisible=!1},handleInitAddressDialog:function(t){this.selectAdress=p(t)},openChooseEnterprise:function(){this.chooseEnterpriseVisible=!0},closeChooseEnterprise:function(){this.chooseEnterpriseVisible=!1},enterpriseChange:function(t,e){this.$set(this.projectInfo,"enterpriseId",t),this.$set(this.projectInfo,"enterpriseName",e),this.chooseEnterpriseVisible=!1,this.$native.showLoading(),this.$set(this.projectInfo,"quaDictId",""),this.selectEnterpriseQuaById()},quaGradeChange:function(t){this.$set(this.projectInfo,"quaDictId",t.detail.value[1].value),this.judgeOrg()},guaranteeTypeChange:function(t){var e=t.currentTarget.dataset.code;this.$set(this.projectInfo,"productType",e),this.judgeOrg()},bindTimeLenChange:function(t){this.timeLenIndex=t.detail.value,this.$set(this.projectInfo,"guaranteeDuration",this.timeLen[t.detail.value].dictValue),this.judgeOrg()},bindTemplateTypeChange:function(t){this.templateTypeIndex=t.detail.value,this.templateTypeId=this.templateType[t.detail.value].id,this.$set(this.projectInfo,"guaranteeTemplateTypeId",this.templateType[t.detail.value].id),this.judgeOrg()},transactionPriceChange:function(){this.judgeOrg()},templeteChange:function(t){this.$set(this.projectInfo,"guaTemplateId",t.detail.value)},financialChange:function(t){var e=this;return f(i.default.mark((function n(){var a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=t.currentTarget.dataset.index,e.$set(e.projectInfo,"orgId",e.orgList[a].orgId),e.$set(e.projectInfo,"productCode",e.orgList[a].productCode),e.$set(e.projectInfo,"estimateBasicPremium",e.orgList[a].estimateBasicPremium),e.$set(e.projectInfo,"guaranteeCost",e.orgList[a].estimateBasicPremium),e.$set(e.projectInfo,"estimateIncome",e.orgList[a].estimateIncome),e.configId=e.orgList[a].configId,Promise.all([e.selectGuaranteeTemplate(),e.selectInsuranceMaterials()]).then((function(t){e.guaTemplate=t[0],e.materialsList=t[1]})).catch((function(t){e.$native.toast(t.toString())}));case 8:case"end":return n.stop()}}),n)})))()},closeMaterialUpload:function(){this.materialUploadVisible=!1},handleSelectTip:function(t){var e=t.currentTarget.dataset.tip;this.$native.toast(e)},judgeOrg:function(){var t=this;return f(i.default.mark((function e(){var n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=u({},t.projectInfo),t.$set(t.projectInfo,"orgId",""),t.$set(t.projectInfo,"productCode",""),t.$set(t.projectInfo,"estimateBasicPremium",""),t.$set(t.projectInfo,"guaranteeCost",""),t.$set(t.projectInfo,"estimateIncome",""),t.$set(t.projectInfo,"guaTemplateId",""),t.$set(t.projectInfo,"guaDiyTemplateId",""),t.configId="",t.orgList=[],t.guaTemplate=[],t.materialsList=[],!(n.enterpriseId&&""!=n.enterpriseId&&n.quaDictId&&""!=n.quaDictId&&n.guaranteeDuration&&""!=n.guaranteeDuration&&n.productType&&""!=n.productType&&t.templateTypeId&&""!=t.templateTypeId&&n.transactionPrice&&""!=n.transactionPrice)){e.next=16;break}return e.next=15,t.selectOrgs();case 15:t.orgList=e.sent;case 16:case"end":return e.stop()}}),e)})))()},guaDiyTemplateFail:function(t){this.$native.toast(t.tempFiles[0].errMsg)},downloadFile:function(e){var n=this;this.$native.showLoadingText("正在打开中。。。");var i=e.currentTarget.dataset.index;console.log(i,this.guaTemplate[i],this.guaTemplate[i].attachUrl),this.$https.downloadFile({url:this.guaTemplate[i].attachUrl}).then((function(e){var i=e.tempFilePath,a=n.$util.get_file_ext(i).ext;"jpeg"!=a&&"jpg"!=a&&"png"!=a?t.saveFile({tempFilePath:e.tempFilePath,success:function(e){t.openDocument({filePath:e.savedFilePath,success:function(t){n.$native.hideLoading()},fail:function(t){n.$native.hideLoading(),n.$native.toast(t.errMsg)}})},fail:function(){n.$native.hideLoading(),n.$native.toast("打开失败")}}):n.previewImage(e.tempFilePath)})).catch((function(t){n.$native.hideLoading(),n.$native.toast(t.toString())}))},previewImage:function(e){this.$native.hideLoading(),t.previewImage({current:e,urls:[e]})},selectGuaranteeTemplateType:function(){var t=this;return new Promise((function(e,n){(0,o.selectGuaranteeTemplateType)().then((function(n){n&&0===n.code?e(n.data):(e([]),t.$native.toast(n.message||"查询保函模板类型失败"))})).catch((function(n){t.$native.toast(n.toString()),e([])}))})).catch((function(e){t.$native.toast(e.toString())}))},selectGuaranteeTemplate:function(){var t=this;return new Promise((function(e,n){(0,o.selectGuaranteeTemplate)({templateTypeId:t.templateTypeId,configId:t.configId}).then((function(n){n&&0===n.code?e(n.data):(e([]),t.$native.toast(n.message||"查询保函模板失败"))})).catch((function(n){t.$native.toast(n.toString()),e([])}))})).catch((function(e){t.$native.toast(e.toString())}))},selectOrgs:function(){var t=this,e=this.projectInfo,n={enterpriseId:e.enterpriseId,guaranteeDuration:e.guaranteeDuration,guaranteeTemplateType:this.templateTypeId,guaranteeType:e.productType,quaDictId:e.quaDictId,bidBond:e.bond,countyCode:e.projectCounty||e.projectCity||e.projectProvince,transactionPrice:e.transactionPrice};return new Promise((function(e,i){(0,o.selectOrgs)(n).then((function(e){e&&0===e.code?t.orgList=e.data:(t.orgList=[],t.$native.toast(e.message||"查询金融机构失败"))})).catch((function(e){t.$native.toast(e.toString()),t.orgList=[]}))})).catch((function(e){t.orgList=[],t.$native.toast(e.toString())}))},selectInsuranceMaterials:function(){var t=this;return new Promise((function(e,n){(0,o.selectInsuranceMaterials)({configId:t.configId}).then((function(n){n&&0===n.code?e(n.data):(e([]),t.$native.toast(n.message||"查询投保材料失败"))})).catch((function(n){t.$native.toast(n.toString()),e([])}))})).catch((function(e){t.$native.toast(e.toString())}))},selectEnterpriseQuaById:function(){var t=this;return new Promise((function(e,n){(0,o.selectEnterpriseQuaById)({enterpriseId:t.projectInfo.enterpriseId}).then((function(e){if(e&&0===e.code){var n=e.data,i=[];n=t.$util.deteleObject(n),n.forEach((function(t){var e={pquaDictId:"0",quaDictId:t.pquaDictId,quaDictName:t.pquaDictName};i.push(e)})),i=t.$util.deteleObject(i),n=n.concat(i),t.initQuaList(n)}else t.$native.hideLoading(),t.$native.toast(e.message||"获取企业资质失败")})).catch((function(e){t.$native.hideLoading(),t.$native.toast(e.toString())}))})).catch((function(e){t.$native.hideLoading(),t.$native.toast(e.toString())}))},initQuaList:function(t){var e=(0,a.default)(t,{id:"quaDictId",pid:"pquaDictId",rootId:"0"},(function(t){return t.text=t.quaDictName,t.value=t.quaDictId,t}));this.enterpriseQuaListData=e,this.$native.hideLoading()},submitStepOne:function(){if(this.submitFlag){this.submitFlag=!1;var t=this.rules,e=u({},this.projectInfo),n=!1;for(var i in t){var a=t[i].label,r=t[i].msg;if(!e[a]){this.$native.toast(r),n=!0;break}if(t[i].reg){var o=t[i].reg,s=t[i].regMsg;if(!o(e[a])){this.$native.toast(s),n=!0;break}}}n||(this.step=2),this.submitFlag=!0}},submitStepTwo:function(){if(this.submitFlag){this.submitFlag=!1;var t=this.rules_two,e=u({},this.projectInfo),n=!1;for(var i in t){var a=t[i].label,r=t[i].msg;if(!e[a]){this.$native.toast(r),n=!0;break}if(t[i].reg){var o=t[i].reg,s=t[i].regMsg;if(!o(e[a])){this.$native.toast(s),n=!0;break}}}if(n)this.submitFlag=!0;else{if("diy"==e.guaTemplateId){if(!(this.guaDiyTemplate&&this.guaDiyTemplate.length>0&&this.guaDiyTemplate[0].attachBatchId&&""!=this.guaDiyTemplate[0].attachBatchId))return this.$native.toast("请上传自定义模板"),void(this.submitFlag=!0);e.guaDiyTemplateId=this.guaDiyTemplate[0].attachBatchId}this.projectInfo=e,this.submitFlag=!0,0==this.materialsList.length?this.submitStepThree([]):this.materialUploadVisible=!0}}},submitStepThree:function(t){if(this.submitFlag){this.$native.showLoading(),this.submitFlag=!1;var e=u({},this.projectInfo);e.insuranceMaterialList=t,"diy"==e.guaTemplateId&&delete e.guaTemplateId,this.saveNoBidOrderInfo(e)}},saveNoBidOrderInfo:function(t){var e=this;(0,o.saveNoBidOrderInfo)(t).then((function(t){t&&0===t.code?(e.$native.hideLoading(),e.dialogSuccessVisible=!0,e.materialUploadVisible=!1,e.submitFlag=!0):(e.$native.hideLoading(),e.$native.toast(t.message||"保存订单失败"),e.submitFlag=!0)})).catch((function(t){e.$native.hideLoading(),e.$native.toast(t.toString()),e.submitFlag=!0}))},handleSuccess:function(){t.navigateBack({})}}};e.default=y}).call(this,n("543d")["default"])},d290:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i}));var i={uniNavBar:function(){return n.e("components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"f31d"))},uniEasyinput:function(){return n.e("components/uni-easyinput/uni-easyinput").then(n.bind(null,"eea8"))},uniDataPicker:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-data-picker/uni-data-picker")]).then(n.bind(null,"d9b2"))},uniFilePicker:function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-file-picker/uni-file-picker")]).then(n.bind(null,"43e3"))},bdMaterialUpload:function(){return n.e("components/bd-material-upload/bd-material-upload").then(n.bind(null,"54f6"))},bdSuccessPage:function(){return n.e("components/bd-success-page/bd-success-page").then(n.bind(null,"fc5b"))},bdChooseEnterprise:function(){return n.e("components/bd-choose-enterprise/bd-choose-enterprise").then(n.bind(null,"f3fd"))},bdAddressDialog:function(){return Promise.all([n.e("common/vendor"),n.e("components/bd-address-dialog/bd-address-dialog")]).then(n.bind(null,"984f"))}},a=function(){var t=this,e=t.$createElement;t._self._c},r=[]},df16:function(t,e,n){"use strict";n.r(e);var i=n("beee"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=a.a}},[["79c1","common/runtime","common/vendor"]]]);