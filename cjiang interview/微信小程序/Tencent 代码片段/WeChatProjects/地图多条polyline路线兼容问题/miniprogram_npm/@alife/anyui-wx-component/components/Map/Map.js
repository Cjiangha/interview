var b=Object.create,d=Object.defineProperty,C=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty,w=Object.getOwnPropertyNames,M=Object.getOwnPropertyDescriptor;var x=t=>d(t,"__esModule",{value:!0});var S=(t,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of w(e))!P.call(t,o)&&o!=="default"&&d(t,o,{get:()=>e[o],enumerable:!(n=M(e,o))||n.enumerable});return t},l=t=>t&&t.__esModule?t:S(x(d(t!=null?b(C(t)):{},"default",{value:t,enumerable:!0})),t);var r=l(require("@alife/anyui-wx-framework/index.js")),s=l(require("@alife/anyui-wx-api/lib/createMapContext.js")),u=l(require("@alife/anyui-wx-api/lib/getSystemInfo.js")),c=l(require("@alife/anyui-wx-framework/index.js"));r.anyui._wrapApi("createMapContext",s.default);r.anyui._wrapApi("getSystemInfo",u.default);var I={blacklist:["gestureEnable","tiltGesturesEnabled","showMapText","logoPosition"],common:{showScale:"showScale",showCompass:"showCompass",trafficEnabled:"enableTraffic"},commonKeys:["showScale","showCompass","trafficEnabled"]},p=[100,50,100,50],A={blacklist:["iconLayout","displayRanges","iconAppendStr","iconAppendStrColor","iconAppendStrColor","style"]};function f(t){return Boolean(Number(t))}function h(t){if(!t)return{};let{blacklist:e,common:n,commonKeys:o}=I,i={};return Object.keys(t).forEach(a=>{e.includes(a)||(o.includes(a)?i[n[a]]=f(t[a]):["skew","rotate","layerStyle","subkey"].includes(a)?i[a]=t[a]:i[a]=f(t[a]))}),i}function m(t){if(!t)return[];let{blacklist:e}=A;return t.map(n=>(e.forEach(o=>delete n[o]),n.markerLevel&&(n.zIndex=n.markerLevel,delete n.markerLevel),n.anchor={},n.anchorX&&(n.anchor.x=n.anchorX,delete n.anchorX),n.anchorY&&(n.anchor.y=n.anchorY,delete n.anchorY),Object.keys(n.anchor).length==0&&delete n.anchor,n))}function _(t){return t?t.map(e=>(e.latitude=parseFloat(e.latitude),e.longitude=parseFloat(e.longitude),e)):[]}function y(t){return t?t.map(e=>(e.iconPath&&(e.arrowLine=!0,e.arrowIconPath=e.iconPath,delete e.iconPath),delete e.iconWidth,e)):[]}function g(t){return t?t.map(e=>(delete e.displayRanges,e.color&&(e.strokeColor=e.color,delete e.color),e.width&&(e.strokeWidth=e.width,delete e.width),e)):[]}function T(t){let{top:e=0,left:n=0,right:o=0,bottom:i=0}=t||{};return[parseFloat(e),parseFloat(o),parseFloat(i),parseFloat(n)]}c.createComponent(k({name:"Map_wx",options:{virtualHost:!1},props:{id:{type:String,default:""},style:{type:[String,Object,Array],default:""},scale:{type:Number,default:16},skew:{type:Number,default:0},rotate:{type:Number,default:0},longitude:{type:Number,default:116.398376},latitude:{type:Number,default:39.912241},showLocation:{type:Boolean,default:!1},markers:{type:Array,default(){return[]}},polygon:{type:Array,default(){return[]}},polyline:{type:Array,default(){return[]}},circles:{type:Array,default(){return[]}},controls:{type:Array,default(){return[]}},includePoints:{type:Array,default(){return[]}},includePadding:{type:Object,default(){return{left:0,right:0,top:0,bottom:0}}},setting:{type:Object,default:{}},onMarkerTap:{type:Function,default:function(){}},onCalloutTap:{type:Function,default:function(){}},onControlTap:{type:Function,default:function(){}},onRegionChange:{type:Function,default:function(){}},onTap:{type:Function,default:function(){}},subkey:{type:String},layerStyle:{type:Number,default:1}},data(){return{inited:!1,isMapDataReady:!1,computedSetting:{},computedMarkers:[],computedPolyline:[],computedPolygon:[],computedIncludePadding:p,mapCtx:null,timer:null,isAndroid:!1}},watch:{setting(t){this.computedSetting=h(t)},markers(t){this.computedMarkers=m(t)},polyline(t){this.computedPolyline=y(t)},polygon(t){this.computedPolygon=g(t)},includePoints(t){this.updateIncludePoints()},includePadding(t){this.computedIncludePadding=T(t)}},methods:{getMapContext(){return this.mapCtx||(this.mapCtx=r.anyui.createMapContext(this.id,this._ctx)),this.mapCtx},updateIncludePoints(){let t=_(this.includePoints);t.length&&this.getMapContext().includePoints({points:t,padding:p})},dealRegionChange(t){let e={};"centerLocation"in t.detail&&(e={...t.detail,...t.detail.centerLocation},delete e.centerLocation,delete e.region),this.onRegionChange({...t,...e})},dealMarkerTap(t){let{markerId:e}=t.detail,n=this.computedMarkers.find(i=>i.id===e),o={};n&&(o.longitude=n.longitude,o.latitude=n.latitude),this.onMarkerTap({...o,...t.detail})},dealCalloutTap(t){let{markerId:e}=t.detail,n=this.computedMarkers.find(i=>i.id===e),o={};n&&(o.longitude=n.longitude,o.latitude=n.latitude),this.onCalloutTap({...o,...t.detail})},dealControlTap(t){this.onControlTap({...t.detail})},dealMapUpdate(t){if(this.inited)return;let e=this.isAndroid?1e3:0;clearTimeout(this.timer),this.timer=setTimeout(()=>{this.inited||(this.updateIncludePoints(),this.inited=!0)},e)}},async created(){let{platform:t}=await r.anyui.getSystemInfo();this.isAndroid=t==="Android",this.computedSetting=h(this.setting),this.computedMarkers=m(this.markers),this.computedPolyline=y(this.polyline),this.computedPolygon=g(this.polygon),this.isMapDataReady=!0},computed:{}}));function k(t={}){return t.methods.returnRef=function(e){e.detail.ref.$parentComponentRef=this},t.$renderKeys=["__ready__","isMapDataReady","proputil","circles","controls","id","latitude","longitude","computedMarkers","computedPolygon","computedPolyline","scale","skew","rotate","style","subkey","layerStyle","computedSetting","showLocation","__slotObj"],t}
