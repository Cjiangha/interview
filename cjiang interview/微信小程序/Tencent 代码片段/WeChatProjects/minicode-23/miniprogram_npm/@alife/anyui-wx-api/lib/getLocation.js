var x=Object.create,p=Object.defineProperty,C=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,L=Object.getOwnPropertyNames,v=Object.getOwnPropertyDescriptor;var g=e=>p(e,"__esModule",{value:!0});var M=(e,c)=>{for(var t in c)p(e,t,{get:c[t],enumerable:!0})},A=(e,c,t)=>{if(c&&typeof c=="object"||typeof c=="function")for(let a of L(c))!D.call(e,a)&&a!=="default"&&p(e,a,{get:()=>c[a],enumerable:!(t=v(c,a))||t.enumerable});return e},N=e=>e&&e.__esModule?e:A(g(p(e!=null?x(C(e)):{},"default",{value:e,enumerable:!0})),e);g(exports);M(exports,{default:()=>k});var u=N(require("../utils.js")),s=null;wx._globalDataCache=wx._globalDataCache||{};wx._globalDataCache._anyui_user_location=wx._globalDataCache._anyui_user_location||s;s=wx._globalDataCache._anyui_user_location;var z={11:{description:"\u8BF7\u786E\u8BA4\u5B9A\u4F4D\u6743\u9650\u5DF2\u5F00\u542F",info:"\u63D0\u793A\u7528\u6237\u786E\u8BA4\u624B\u673A\u662F\u5426\u5DF2\u7ED9\u652F\u4ED8\u5B9D APP \u83B7\u53D6\u5B9A\u4F4D\u6743\u9650\u3002"},12:{description:"\u7F51\u7EDC\u5F02\u5E38\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",info:"\u63D0\u793A\u7528\u6237\u68C0\u67E5\u5F53\u524D\u7F51\u7EDC\u3002"},13:{description:"\u5B9A\u4F4D\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",info:"\u63D0\u793A\u7528\u6237\u518D\u6B21\u5C1D\u8BD5\u3002"},14:{description:"\u4E1A\u52A1\u5B9A\u4F4D\u8D85\u65F6",info:"\u63D0\u793A\u7528\u6237\u518D\u6B21\u5C1D\u8BD5\u3002"},2001:{description:"\u7528\u6237\u62D2\u7EDD\u7ED9\u5C0F\u7A0B\u5E8F\u6388\u6743",info:"\u7528\u6237\u4E0D\u5141\u8BB8\u6388\u6743"}};function h(e){return{error:e,message:z[e].description}}async function S(e){let{longitude:c,latitude:t}=e,a="d3f5d8b3b05231fa6a11375492310e3a",i;try{i=await u.promisify(wx.request)({url:`https://restapi.amap.com/v3/geocode/regeo?output=JSON&location=${c},${t}&key=${a}&radius=1000&extensions=all`,timeout:5e3})}catch(o){}let l=null;return i&&i.data&&i.data.status==="1"&&(l={...i.data.regeocode.addressComponent,pois:i.data.regeocode.pois}),l}async function $(e={}){if(e.type=e.type||0,e.cacheTimeout===void 0)e.cacheTimeout=30;else if(typeof e.cacheTimeout!="number"){console.warn("cacheTimeout\u53C2\u6570\u4E3ANumber\u7C7B\u578B");let t=parseInt(e.cacheTimeout);!t&&t!==0&&(t=30),e.cacheTimeout=t}if(s&&s.type===e.type&&+new Date-s.timestamp<=s.cacheTimeout*1e3){e.success&&e.success(s.data),e.complete&&e.complete(s.data);return}e.type>0&&console.warn("\u83B7\u53D6\u7528\u6237\u8BE6\u7EC6\u5730\u7406\u4F4D\u7F6E\u65F6\uFF0Chttps://restapi.amap.com \u9700\u8981\u6CE8\u518C\u5230request \u5408\u6CD5\u57DF\u540D\u5217\u8868\u4E2D");try{(await u.promisify(wx.getSetting)()).authSetting["scope.userLocation"]===!1&&await u.promisify(wx.authorize({scope:"scope.userLocation"}))()}catch(t){let a={errorMessage:"\u8BF7\u786E\u8BA4\u5B9A\u4F4D\u76F8\u5173\u6743\u9650\u5DF2\u5F00\u542F",error:11};e.fail&&e.fail(a),e.complete&&e.complete(a)}let c;try{c=await u.promisify(wx.getLocation)({type:"gcj02"})}catch(t){let a=12;/fail auth deny|authorize no response/.test(t.errMsg)?a=2001:/system permission denied/.test(t.errMsg)&&(a=11);let i=h(a);e.complete&&e.complete(i)}if(c&&c.longitude){let{accuracy:t,horizontalAccuracy:a,latitude:i,longitude:l}=c,o={accuracy:t,horizontalAccuracy:a,latitude:i,longitude:l};if(e.type>0){let n=await S({latitude:c.latitude,longitude:c.longitude});if(n===null){let r=h(12);e.fail&&e.fail(r),e.complete&&e.complete(r)}else{let{adcode:r,country:m,district:w,province:_,pois:T,streetNumber:f}=n,d=n.city;typeof d!="string"&&(d=["\u5317\u4EAC\u5E02","\u4E0A\u6D77\u5E02","\u5929\u6D25\u5E02","\u91CD\u5E86\u5E02"].includes(n.province)?n.province:n.district),Object.assign(o,{city:d,cityAdcode:r.substring(0,r.length-2)+"00",country:m,countryCode:m==="\u4E2D\u56FD"?156:"",district:w,districtAdcode:r,province:_,pois:e.type>2?T.map(y=>({name:y.name,address:y.address})):[]}),e.type>1&&(o.streetNumber={street:f.street,number:f.number}),e.success&&e.success(o),e.complete&&e.complete(o),e.cacheTimeout&&(s={data:o,type:e.type,timestamp:+new Date,cacheTimeout:e.cacheTimeout})}}else e.success&&e.success(o),e.complete&&e.complete(o),e.cacheTimeout&&(s={data:o,type:e.type,timestamp:+new Date,cacheTimeout:e.cacheTimeout})}}var k=u.promisify($);
